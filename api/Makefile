$(info Using OS    : $(OS))
$(info Using shell : $(SHELL))

APP_NAME := otel-api
DOCKER := docker

# Yeah, it's hacky to handle cross-platform using if/else. :D
ifeq ($(OS), Windows_NT)
	MVN := .\mvnw.cmd
else
	MVN := ./mvnw
endif

.PHONY: all clean package docker

all: clean package docker

clean:
	$(info =====[ CLEANING MAVEN PACKAGE: $(APP_NAME) ]=====)
ifeq ($(OS), Windows_NT)
	if exist .\tmp rmdir /Q /S .\tmp
else
	rm -rf ./tmp
endif
	$(MVN) -e clean

package:
	$(info =====[ BUILDING MAVEN PACKAGE: $(APP_NAME) ]=====)
	$(MVN) -e package spring-boot:repackage -DskipTests

docker:
	$(info =====[ BUILDING DOCKER PACKAGE: $(APP_NAME) ]=====)
ifeq ($(OS), Windows_NT)
	if not exist .\tmp mkdir .\tmp
	copy ..\agents\apache-skywalking-java-agent-8.10.0.tgz .\tmp
else
	mkdir -p ./tmp
	cp ../agents/apache-skywalking-java-agent-8.10.0.tgz ./tmp
endif
	$(DOCKER) build -t $(APP_NAME) .
